name: Actualizar datos de Airtable

on:
  schedule:
    - cron: '0 * * * *'  # Cada hora
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
    - name: Clonar el repositorio
      uses: actions/checkout@v3

    - name: Descargar datos de Airtable
      env:
        AIRTABLE_TOKEN: ${{ secrets.AIRTABLE_TOKEN }}
      run: |
        mkdir -p data
        curl -s -H "Authorization: Bearer $AIRTABLE_TOKEN" \
        "https://api.airtable.com/v0/appo1MtSst3hKF0ky/Puntos" \
        > data/airtable.json

    - name: Hacer commit y push de los datos actualizados
      env:
        GH_PAT: ${{ secrets.GH_PAT }}
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
        git remote set-url origin https://x-access-token:${GH_PAT}@github.com/${{ github.repository }}
        git add data/airtable.json
        git commit -m "Update Airtable data" || echo "No hay cambios"
        git push || echo "Push fall√≥"
